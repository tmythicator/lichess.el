#+TITLE: lichess.el
#+OPTIONS: toc:nil num:nil
#+AUTHOR: Alexandr Timchenko

[[https://github.com/tmythicator/Lichess.el/actions/workflows/test.yml/badge.svg]]
[[https://img.shields.io/badge/Built_with-Nix-5277C3.svg?style=flat-square&logo=nixos&logoColor=white]]

A minimal Emacs client for the [[https://lichess.org/api][Lichess API]].

* Showcase
Here is a quick demonstration of browsing Lichess TV and watching a live game:

[[file:demo/lichess-tv.gif]]

*Display Support*
Lichess.el is designed to work seamlessly in both **GUI** and **terminal** (=emacs -nw=) versions of Emacs. Rendering uses a simple text-based board for the best compatibility.

* Features
- TV
  - [X] Live Lichess TV channels list (=M-x lichess-tv=)
  - [X] Select a game with =RET= to watch it live inside Emacs.
  - [X] Inspect any TV channel (=M-x lichess-tv-debug=)
- Live Game Watcher
  - [X] Stream any Lichess game by its ID (M-x lichess-game-watch).
  - [X] Real-time board updates via the NDJSON stream.
  - [X] Full game history navigation with =p= (previous) and =n= (next).
  - [X] Switch board perspective with =v= (auto, white, black).
- Playing
  - [X] Challenge Lichess AI (=M-x lichess-ai-challenge=)
  - [X] Make moves with =m= (UCI format)
  - [X] Resign with =R=
  - [X] Propose/Accept draw with =D=
- Core
  - [X] Interactive umbrella dispatcher (=M-x lichess=)
  - [X] Diagnostics: token + active games (=M-x lichess-diagnose=)
- FEN / Board
  - [X] Parse FEN -> internal position struct
  - [X] Render board (ASCII or Unicode)
  - [X] Header displays side-to-move, castling rights, en passant target, and perspective.
- Roadmap
  - [X] Watch a single game (=lichess-game.el=)
  - [X] Live board stream (NDJSON)
  - [X] Submit moves and play
  - [X] Challenge API (against AI)
  - [ ] MELPA packaging
  - [ ] Puzzles & tactics
* Installation
Clone and add to your load path:
#+begin_src elisp
(add-to-list 'load-path "~/path/to/your/lichess")
(require 'lichess)
#+end_src
* Authentication
Some commands require a personal API token:

1. Go to [[https://lichess.org/account/oauth/token]]
2. Create a token.
3. In Emacs:
#+begin_src elisp
(setq lichess-token "YOUR_TOKEN_HERE")
#+end_src

* Usage
- =M-x lichess= -> main entrypoint, shows dispatcher to all subcommands
- =M-x lichess-tv= -> show TV channels list
  - =g= refreshes list
  - =RET= opens game on the current line
- =M-x lichess-ai-challenge= -> start a new game against Stockfish
- =M-x lichess-game-watch= -> watch a specific game ID

* How to Play
When in a game buffer (started via =M-x lichess-ai-challenge=):
- =m= -> Prompt for a move (UCI format, e.g., =e2e4=)
- =R= -> Resign the game (requires confirmation)
- =D= -> Propose or accept a draw (requires confirmation)
- =p= / =n= -> Navigate move history
- =v= -> Cycle board perspective
- =q= -> Quit stream and close game

* Development
This project uses a =Makefile= for common development tasks. If you use Nix, you can enter a reproducible environment with all dependencies pre-installed.

** Set up environment (Nix users)
You can use =direnv= to automatically load the dependencies when you enter the directory:
#+begin_src bash
direnv allow
#+end_src

Alternatively, enter the environment manually:
#+begin_src bash
nix develop
#+end_src

** Common Commands
- *Format code*: =make format= (uses =elisp-autofmt=)
- *Run tests*: =make test=
- *Lint*: =make lint= (uses =package-lint=)
- *Byte-compile*: =make compile=
- *Clean*: =make clean= (removes =.elc= files)

** CI/CD
All pull requests are automatically checked for formatting, linting, and tests via GitHub Actions.

* Font Configuration (GUI)
If the chess board looks misaligned in the Emacs GUI, it is likely due to font metric differences for Unicode pieces. You can fix this by forcing a monospaced font:

#+BEGIN_SRC elisp
;; Option A: Standard configuration
(setq lichess-token "YOUR_TOKEN")
(setq lichess-core-chess-font "DejaVu Sans Mono")

;; Option B: Full use-package configuration
(use-package lichess
  :custom
  (lichess-token "YOUR_TOKEN")
  (lichess-core-chess-font "DejaVu Sans Mono"))
#+END_SRC

You can also run =M-x lichess-core-setup-chess-font= interactively to test different fonts.

* License
GPL-3.0-or-later See LICENSE for details.
